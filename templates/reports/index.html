.chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #1e40af;
        margin: 0;
    }
    
    .chart-controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .time-period-selector {
        background: #f8fafc;
        border-radius: 10px;
        padding: 5px;
        display: flex;
        gap: 5px;
    }
    
    .period-btn {
        border: none;
        background: transparent;
        padding: 8px 15px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .period-btn.active {
        background: #3b82f6;
        color: white;
    }
    
    .period-btn:hover:not(.active) {
        background: #e2e8f0;
        color: #1e40af;
    }
    
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .kpi-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        border-radius: 15px 15px 0 0;
    }
    
    .kpi-card.revenue::before { background: linear-gradient(135deg, #10b981, #059669); }
    .kpi-card.sales::before { background: linear-gradient(135deg, #3b82f6, #1e40af); }
    .kpi-card.customers::before { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .kpi-card.jobs::before { background: linear-gradient(135deg, #f59e0b, #d97706); }
    
    .kpi-value {
        font-size: 2.2rem;
        font-weight: 700;
        color: #1e40af;
        margin-bottom: 5px;
    }
    
    .kpi-label {
        color: #6b7280;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .kpi-change {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .kpi-change.positive {
        color: #16a34a;
    }
    
    .kpi-change.negative {
        color: #dc2626;
    }
    
    .filter-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    .report-categories {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .category-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
    }
    
    .category-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1e40af;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .report-item {
        display: flex;
        justify-content: between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f1f5f9;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .report-item:last-child {
        border-bottom: none;
    }
    
    .report-item:hover {
        background: #f8fafc;
        margin: 0 -20px;
        padding-left: 20px;
        padding-right: 20px;
    }
    
    .report-info {
        flex: 1;
    }
    
    .report-name {
        font-weight: 500;
        color: #374151;
        margin-bottom: 3px;
    }
    
    .report-desc {
        font-size: 0.8rem;
        color: #6b7280;
    }
    
    .report-action {
        color: #3b82f6;
        font-size: 0.9rem;
    }
    
    .export-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    .export-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .export-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        background: white;
        color: #6b7280;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .export-btn:hover {
        border-color: #3b82f6;
        color: #1e40af;
        background: #f8fafc;
    }
    
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    @media (max-width: 1200px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .chart-canvas {
        width: 100%;
        height: 300px;
    }
    
    .data-table {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
        overflow: hidden;
    }
    
    .data-table table {
        margin: 0;
    }
    
    .data-table th {
        background: #f8fafc;
        border: none;
        color: #374151;
        font-weight: 600;
        padding: 15px 20px;
        font-size: 0.9rem;
    }
    
    .data-table td {
        border: none;
        padding: 12px 20px;
        vertical-align: middle;
        font-size: 0.9rem;
    }
    
    .data-table tbody tr {
        border-bottom: 1px solid #f1f5f9;
        transition: background-color 0.3s ease;
    }
    
    .data-table tbody tr:hover {
        background: #f8fafc;
    }
    
    .trend-indicator {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .trend-up {
        background: #dcfce7;
        color: #16a34a;
    }
    
    .trend-down {
        background: #fee2e2;
        color: #dc2626;
    }
    
    .trend-stable {
        background: #f3f4f6;
        color: #6b7280;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 text-gray-800 mb-0">
                        <i class="fas fa-chart-line me-2 text-primary"></i>รายงาน
                    </h1>
                    <p class="text-muted mb-0">วิเคราะห์ข้อมูลและสถิติการดำเนินงาน</p>
                </div>
                <div class="d-flex gap-3">
                    <button class="btn btn-outline-primary" onclick="scheduleReport()">
                        <i class="fas fa-clock me-2"></i>กำหนดรายงาน
                    </button>
                    <button class="btn btn-primary" onclick="generateCustomReport()">
                        <i class="fas fa-plus me-2"></i>สร้างรายงานกำหนดเอง
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card revenue">
            <div class="kpi-value">{{ "{:,.0f}".format(total_revenue or 0) }}</div>
            <div class="kpi-label">รายได้รวม (฿)</div>
            <div class="kpi-change positive">
                <i class="fas fa-arrow-up"></i>
                +12.5% จากเดือนที่แล้ว
            </div>
        </div>
        <div class="kpi-card sales">
            <div class="kpi-value">{{ total_sales or 0 }}</div>
            <div class="kpi-label">ยอดขายทั้งหมด</div>
            <div class="kpi-change positive">
                <i class="fas fa-arrow-up"></i>
                +8.3% จากเดือนที่แล้ว
            </div>
        </div>
        <div class="kpi-card customers">
            <div class="kpi-value">{{ total_customers or 0 }}</div>
            <div class="kpi-label">ลูกค้าทั้งหมด</div>
            <div class="kpi-change positive">
                <i class="fas fa-arrow-up"></i>
                +5.7% จากเดือนที่แล้ว
            </div>
        </div>
        <div class="kpi-card jobs">
            <div class="kpi-value">{{ completed_jobs or 0 }}</div>
            <div class="kpi-label">งานที่เสร็จสิ้น</div>
            <div class="kpi-change positive">
                <i class="fas fa-arrow-up"></i>
                +15.2% จากเดือนที่แล้ว
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-3 mb-3">
                <label class="form-label">ช่วงเวลา</label>
                <select class="form-control" id="timeRange">
                    <option value="7days">7 วันล่าสุด</option>
                    <option value="30days" selected>30 วันล่าสุด</option>
                    <option value="3months">3 เดือนล่าสุด</option>
                    <option value="6months">6 เดือนล่าสุด</option>
                    <option value="1year">1 ปีล่าสุด</option>
                    <option value="custom">กำหนดเอง</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">วันที่เริ่มต้น</label>
                <input type="date" class="form-control" id="startDate">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">วันที่สิ้นสุด</label>
                <input type="date" class="form-control" id="endDate">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-primary w-100" onclick="updateReports()">
                    <i class="fas fa-sync me-2"></i>อัปเดตรายงาน
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Charts Section -->
        <div>
            <!-- Revenue Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-line me-2"></i>แนวโน้มรายได้
                    </h3>
                    <div class="chart-controls">
                        <div class="time-period-selector">
                            <button class="period-btn active" data-period="daily">รายวัน</button>
                            <button class="period-btn" data-period="weekly">รายสัปดาห์</button>
                            <button class="period-btn" data-period="monthly">รายเดือน</button>
                        </div>
                    </div>
                </div>
                <canvas id="revenueChart" class="chart-canvas"></canvas>
            </div>

            <!-- Sales vs Service Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-pie me-2"></i>สัดส่วนรายได้
                    </h3>
                </div>
                <canvas id="revenueBreakdownChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <!-- Top Products/Services -->
        <div>
            <div class="data-table">
                <div class="chart-header" style="margin: 0; border-bottom: 1px solid #e2e8f0;">
                    <h3 class="chart-title">
                        <i class="fas fa-trophy me-2"></i>สินค้ายอดนิยม
                    </h3>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>อันดับ</th>
                            <th>สินค้า</th>
                            <th>ยอดขาย</th>
                            <th>แนวโน้ม</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge bg-warning">1</span></td>
                            <td>ฟิล์มกันรอย iPhone</td>
                            <td class="fw-bold">127 ชิ้น</td>
                            <td><span class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> +15%</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-secondary">2</span></td>
                            <td>เคสโทรศัพท์ Samsung</td>
                            <td class="fw-bold">89 ชิ้น</td>
                            <td><span class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> +8%</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-warning">3</span></td>
                            <td>หูฟัง Bluetooth</td>
                            <td class="fw-bold">76 ชิ้น</td>
                            <td><span class="trend-indicator trend-down"><i class="fas fa-arrow-down"></i> -3%</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-secondary">4</span></td>
                            <td>สายชาร์จ Type-C</td>
                            <td class="fw-bold">65 ชิ้น</td>
                            <td><span class="trend-indicator trend-stable"><i class="fas fa-minus"></i> 0%</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge bg-secondary">5</span></td>
                            <td>Power Bank</td>
                            <td class="fw-bold">43 ชิ้น</td>
                            <td><span class="trend-indicator trend-up"><i class="fas fa-arrow-up"></i> +12%</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Report Categories -->
    <div class="report-categories">
        <!-- Sales Reports -->
        <div class="category-section">
            <div class="category-title">
                <i class="fas fa-shopping-cart"></i>
                รายงานการขาย
            </div>
            <div class="report-item" onclick="generateReport('daily-sales')">
                <div class="report-info">
                    <div class="report-name">รายงานยอดขายรายวัน</div>
                    <div class="report-desc">สรุปยอดขายและรายได้ในแต่ละวัน</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('product-sales')">
                <div class="report-info">
                    <div class="report-name">รายงานยอดขายสินค้า</div>
                    <div class="report-desc">วิเคราะห์ยอดขายแต่ละประเภทสินค้า</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('payment-methods')">
                <div class="report-info">
                    <div class="report-name">รายงานวิธีการชำระเงิน</div>
                    <div class="report-desc">สถิติการชำระเงินแต่ละประเภท</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
        </div>

        <!-- Service Reports -->
        <div class="category-section">
            <div class="category-title">
                <i class="fas fa-tools"></i>
                รายงานการบริการ
            </div>
            <div class="report-item" onclick="generateReport('service-jobs')">
                <div class="report-info">
                    <div class="report-name">รายงานงานบริการ</div>
                    <div class="report-desc">สรุปงานซ่อมและบริการทั้งหมด</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('technician-performance')">
                <div class="report-info">
                    <div class="report-name">รายงานประสิทธิภาพช่าง</div>
                    <div class="report-desc">วิเคราะห์ผลงานของช่างเทคนิค</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('service-time')">
                <div class="report-info">
                    <div class="report-name">รายงานระยะเวลาบริการ</div>
                    <div class="report-desc">วิเคราะห์เวลาในการดำเนินงาน</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
        </div>

        <!-- Customer Reports -->
        <div class="category-section">
            <div class="category-title">
                <i class="fas fa-users"></i>
                รายงานลูกค้า
            </div>
            <div class="report-item" onclick="generateReport('customer-analysis')">
                <div class="report-info">
                    <div class="report-name">วิเคราะห์ลูกค้า</div>
                    <div class="report-desc">ข้อมูลและพฤติกรรมลูกค้า</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('customer-retention')">
                <div class="report-info">
                    <div class="report-name">รายงานการกลับมาใช้บริการ</div>
                    <div class="report-desc">อัตราการกลับมาของลูกค้า</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('customer-satisfaction')">
                <div class="report-info">
                    <div class="report-name">รายงานความพึงพอใจ</div>
                    <div class="report-desc">คะแนนความพึงพอใจของลูกค้า</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
        </div>

        <!-- Inventory Reports -->
        <div class="category-section">
            <div class="category-title">
                <i class="fas fa-warehouse"></i>
                รายงานคลังสินค้า
            </div>
            <div class="report-item" onclick="generateReport('inventory-status')">
                <div class="report-info">
                    <div class="report-name">รายงานสถานะสต็อก</div>
                    <div class="report-desc">ข้อมูลสต็อกและการเคลื่อนไหว</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('low-stock')">
                <div class="report-info">
                    <div class="report-name">รายงานสินค้าใกล้หมด</div>
                    <div class="report-desc">รายการสินค้าที่ต้องสั่งเพิ่ม</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <div class="report-item" onclick="generateReport('inventory-valuation')">
                <div class="report-info">
                    <div class="report-name">รายงานมูลค่าสต็อก</div>
                    <div class="report-desc">คำนวณมูลค่าสินค้าคงคลัง</div>
                </div>
                <div class="report-action">
                    <i class="fas fa-download"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Section -->
    <div class="export-section">
        <h4 class="mb-3">
            <i class="fas fa-download me-2"></i>ส่งออกรายงาน
        </h4>
        <div class="export-options">
            <a href="#" class="export-btn" onclick="exportReport('pdf')">
                <i class="fas fa-file-pdf"></i>
                ส่งออก PDF
            </a>
            <a href="#" class="export-btn" onclick="exportReport('excel')">
                <i class="fas fa-file-excel"></i>
                ส่งออก Excel
            </a>
            <a href="#" class="export-btn" onclick="exportReport('csv')">
                <i class="fas fa-file-csv"></i>
                ส่งออก CSV
            </a>
            <a href="#" class="export-btn" onclick="emailReport()">
                <i class="fas fa-envelope"></i>
                ส่งทางอีเมล
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Initialize charts
let revenueChart, revenueBreakdownChart;

document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    setupEventListeners();
});

function initializeCharts() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['1 ม.ค.', '2 ม.ค.', '3 ม.ค.', '4 ม.ค.', '5 ม.ค.', '6 ม.ค.', '7 ม.ค.'],
            datasets: [{
                label: 'รายได้ (฿)',
                data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + ' ฿';
                        }
                    }
                }
            }
        }
    });

    // Revenue Breakdown Chart
    const breakdownCtx = document.getElementById('revenueBreakdownChart').getContext('2d');
    revenueBreakdownChart = new Chart(breakdownCtx, {
        type: 'doughnut',
        data: {
            labels: ['ขายสินค้า', 'งานบริการ', 'อะไหล่'],
            datasets: [{
                data: [65, 25, 10],
                backgroundColor: [
                    '#3b82f6',
                    '#10b981', 
                    '#f59e0b'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}

function setupEventListeners() {
    // Period buttons
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const period = this.dataset.period;
            updateChartData(period);
        });
    });

    // Time range selector
    document.getElementById('timeRange').addEventListener('change', function() {
        if (this.value === 'custom') {
            document.getElementById('startDate').style.display = 'block';
            document.getElementById('endDate').style.display = 'block';
        } else {
            document.getElementById('startDate').style.display = 'none';
            document.getElementById('endDate').style.display = 'none';
            updateReports();
        }
    });
}

function updateChartData(period) {
    // Mock data for different periods
    const data = {
        daily: {
            labels: ['จันทร์', 'อังคาร', 'พุธ', 'พฤหัส', 'ศุกร์', 'เสาร์', 'อาทิตย์'],
            values: [12000, 19000, 15000, 25000, 22000, 30000, 28000]
        },
        weekly: {
            labels: ['สัปดาห์ 1', 'สัปดาห์ 2', 'สัปดาห์ 3', 'สัปดาห์ 4'],
            values: [85000, 92000, 78000, 105000]
        },
        monthly: {
            labels: ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.'],
            values: [320000, 280000, 350000, 290000, 410000, 380000]
        }
    };
    
    const selectedData = data[period];
    revenueChart.data.labels = selectedData.labels;
    revenueChart.data.datasets[0].data = selectedData.values;
    revenueChart.update();
}

function updateReports() {
    const timeRange = document.getElementById('timeRange').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    // Show loading indicator
    const updateBtn = document.querySelector('button[onclick="updateReports()"]');
    const originalText = updateBtn.innerHTML;
    updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>กำลังอัปเดต...';
    updateBtn.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        // Update KPI values and charts here
        updateBtn.innerHTML = originalText;
        updateBtn.disabled = false;
        
        // Show success message
        showToast('อัปเดตรายงานสำเร็จ', 'success');
    }, 2000);
}

function generateReport(reportType) {
    const timeRange = document.getElementById('timeRange').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    // Show loading
    showToast('กำลังสร้างรายงาน...', 'info');
    
    // Generate report based on type
    const reportUrl = `/reports/${reportType}?range=${timeRange}&start=${startDate}&end=${endDate}`;
    
    // Simulate report generation
    setTimeout(() => {
        window.open(reportUrl, '_blank');
        showToast('สร้างรายงานสำเร็จ', 'success');
    }, 1500);
}

function exportReport(format) {
    const timeRange = document.getElementById('timeRange').value;
    
    showToast(`กำลังส่งออกรายงานในรูปแบบ ${format.toUpperCase()}...`, 'info');
    
    // Simulate export
    setTimeout(() => {
        const exportUrl = `/reports/export?format=${format}&range=${timeRange}`;
        window.open(exportUrl, '_blank');
        showToast('ส่งออกรายงานสำเร็จ', 'success');
    }, 2000);
}

function emailReport() {
    const email = prompt('กรุณาระบุอีเมลที่ต้องการส่ง:');
    if (email) {
        showToast('กำลังส่งรายงานทางอีเมล...', 'info');
        
        // Simulate email sending
        setTimeout(() => {
            showToast(`ส่งรายงานไปยัง ${email} สำเร็จ`, 'success');
        }, 2000);
    }
}

function scheduleReport() {
    // Open schedule modal
    const modal = `
        <div class="modal fade" id="scheduleModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" style="border-radius: 15px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #3b82f6, #1e40af); color: white;">
                        <h5 class="modal-title">
                            <i class="fas fa-clock me-2"></i>กำหนดรายงานอัตโนมัติ
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <form id="scheduleForm">
                            <div class="mb-3">
                                <label class="form-label">ประเภทรายงาน</label>
                                <select class="form-control" name="report_type" required>
                                    <option value="">เลือกประเภทรายงาน</option>
                                    <option value="daily-sales">รายงานยอดขายรายวัน</option>
                                    <option value="weekly-summary">สรุปรายสัปดาห์</option>
                                    <option value="monthly-summary">สรุปรายเดือน</option>
                                    <option value="inventory-status">สถานะคลังสินค้า</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ความถี่</label>
                                <select class="form-control" name="frequency" required>
                                    <option value="">เลือกความถี่</option>
                                    <option value="daily">รายวัน</option>
                                    <option value="weekly">รายสัปดาห์</option>
                                    <option value="monthly">รายเดือน</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">เวลาส่ง</label>
                                <input type="time" class="form-control" name="send_time" value="09:00" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">อีเมลผู้รับ</label>
                                <input type="email" class="form-control" name="recipient_email" 
                                       placeholder="example@email.com" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">รูปแบบไฟล์</label>
                                <select class="form-control" name="file_format" required>
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="button" class="btn btn-primary" onclick="saveSchedule()">
                            <i class="fas fa-save me-2"></i>บันทึก
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modal);
    const scheduleModal = new bootstrap.Modal(document.getElementById('scheduleModal'));
    scheduleModal.show();
    
    // Remove modal after hiding
    document.getElementById('scheduleModal').addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
}

function saveSchedule() {
    const form = document.getElementById('scheduleForm');
    const formData = new FormData(form);
    
    // Validate form
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    showToast('กำลังบันทึกการกำหนดรายงาน...', 'info');
    
    // Simulate saving
    setTimeout(() => {
        bootstrap.Modal.getInstance(document.getElementById('scheduleModal')).hide();
        showToast('กำหนดรายงานอัตโนมัติสำเร็จ', 'success');
    }, 1500);
}

function generateCustomReport() {
    // Open custom report builder modal
    const modal = `
        <div class="modal fade" id="customReportModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content" style="border-radius: 15px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
                        <h5 class="modal-title">
                            <i class="fas fa-plus me-2"></i>สร้างรายงานกำหนดเอง
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <form id="customReportForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ชื่อรายงาน</label>
                                    <input type="text" class="form-control" name="report_name" 
                                           placeholder="ระบุชื่อรายงาน" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">ประเภทรายงาน</label>
                                    <select class="form-control" name="report_category" required>
                                        <option value="">เลือกประเภท</option>
                                        <option value="sales">การขาย</option>
                                        <option value="service">การบริการ</option>
                                        <option value="customer">ลูกค้า</option>
                                        <option value="inventory">คลังสินค้า</option>
                                        <option value="financial">การเงิน</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">วันที่เริ่มต้น</label>
                                    <input type="date" class="form-control" name="start_date" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">วันที่สิ้นสุด</label>
                                    <input type="date" class="form-control" name="end_date" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">รูปแบบไฟล์</label>
                                    <select class="form-control" name="output_format" required>
                                        <option value="pdf">PDF</option>
                                        <option value="excel">Excel</option>
                                        <option value="csv">CSV</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">เลือกข้อมูลที่ต้องการ</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_sales" value="1" checked>
                                            <label class="form-check-label">ข้อมูลการขาย</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_customers" value="1">
                                            <label class="form-check-label">ข้อมูลลูกค้า</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_products" value="1">
                                            <label class="form-check-label">ข้อมูลสินค้า</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_services" value="1">
                                            <label class="form-check-label">ข้อมูลการบริการ</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_inventory" value="1">
                                            <label class="form-check-label">ข้อมูลสต็อก</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="include_financials" value="1">
                                            <label class="form-check-label">ข้อมูลการเงิน</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">กรองข้อมูล (ถ้ามี)</label>
                                <textarea class="form-control" name="filters" rows="3" 
                                          placeholder="ระบุเงื่อนไขการกรองข้อมูล เช่น ลูกค้าประเภทบุคคล, สินค้าราคาสูงกว่า 1000 บาท"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">หมายเหตุ</label>
                                <textarea class="form-control" name="notes" rows="2" 
                                          placeholder="หมายเหตุเพิ่มเติม..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                        <button type="button" class="btn btn-success" onclick="generateCustomReportSubmit()">
                            <i class="fas fa-cog me-2"></i>สร้างรายงาน
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modal);
    const customModal = new bootstrap.Modal(document.getElementById('customReportModal'));
    customModal.show();
    
    // Remove modal after hiding
    document.getElementById('customReportModal').addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
}

function generateCustomReportSubmit() {
    const form = document.getElementById('customReportForm');
    const formData = new FormData(form);
    
    // Validate form
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    showToast('กำลังสร้างรายงานกำหนดเอง...', 'info');
    
    // Simulate report generation
    setTimeout(() => {
        bootstrap.Modal.getInstance(document.getElementById('customReportModal')).hide();
        showToast('สร้างรายงานกำหนดเองสำเร็จ', 'success');
        
        // Open generated report
        window.open('/reports/custom/latest', '_blank');
    }, 3000);
}

function showToast(message, type = 'info') {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 5000);
}

// Initialize date inputs with current date
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    
    document.getElementById('startDate').value = monthAgo;
    document.getElementById('endDate').value = today;
});
</script>
{% endblock %}{% extends "base.html" %}

{% block title %}รายงาน{% endblock %}

{% block extra_css %}
<style>
    .report-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        border: 1px solid #e2e8f0;
        overflow: hidden;
        cursor: pointer;
    }
    
    .report-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        border-color: #3b82f6;
    }
    
    .report-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 2rem;
        color: white;
    }
    
    .report-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 10px;
    }
    
    .report-description {
        color: #6b7280;
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 15px;
    }
    
    .report-stats {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: #9ca3af;
    }
    
    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        border: 1px solid #e2e8f0;
        margin-bottom: 20px;
    }
    
    .chart-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .chart-title {
        font-size: 1.2rem;
        font-weight:
		{% endblock %}